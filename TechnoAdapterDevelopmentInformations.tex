\documentclass[9pt,a4paper]{article}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{hyperref}
\usepackage[T1]{fontenc}
\usepackage{lmodern}

\author{Etienne Louboutin}
\title{Technology Adapter Development : Quick start}
\begin{document}

\maketitle

\tableofcontents

\section{Abstract}

This document presents technical components of developing a simple Technology Adapter for Openflexo. Some concepts of modelling  will be explained.


\section{Used technologies}
	\subsection{Versioning : Git}
		The sources are available to download in https on \href{https://github.com/orgs/openflexo-team/dashboard}{Github}. To develop a technology adapter, only two repositories are necessary to clone, openflexo-packaging and openflexo-technology-adapter. It will be explained in a further section.
		
	\subsection{Dependencies management}
		To manage dependencies, the Apache technology Maven has been chosen. A configuration file to access Openflexo Maven repositories is available in the git repository openflexo-production, named \textit{settings.xml}. On Unix/Linux OSs, this file has to be placed in the .m2 directory in user's home.
		
\section{Installation}
	\subsection{Quick install : using a VM}
	Some technology are necessary to begin the development, so a virtual machine is available if setting up all the environment is not an option.\\
This VM is a Debian Jessie, which logging information are simple, there is only one user, named User, which password is user in sudoers. The export was made with Virtualbox using the format OVF2.0. You can get this VM \href{https://downloads.openflexo.org/vms/}{here}.
	
	\subsection{Custom install : Configuring environment}
	The main Eclipse plug-in needed is m2e, available in their common repository. This plug-in is used to integrate Maven in Eclipse, which is the nature of Openflexo projects. The installation of eGit is recommended, to manage versioning directly in Eclipse. On windows it is enough. To be able to do artifact generation on command line on Linux (see after) the installation of Maven is needed (available on different distributions' repositories).\\
	To push code, Git option \textit{core.autocrlf} has to be set with the value \textit{input} on Unix/Linux and with the value \textit{true} on Windows.
	
\section{Module generation}
	\subsection{Maven archetype}
		\subsubsection{Introduction}
		Maven can generate skeleton of projects, and in Openflexo repository, an archetype to generate a technology adapter skeleton is available. This section is about the generation and on the content obtained.
	
		\subsubsection{Command-line}
		To generate in command line such a skeleton, the following command has to be used~:\\
		mvn archetype:generate\\
		\indent-DarchetypeGroupId=org.openflexo.archetypes\\
		\indent-DarchetypeArtifactId=technologyadapter-archetype-simplemodel\\
		\indent-DarchetypeVersion=1.7.0-SNAPSHOT\\
		For consistency purpose, it is recommend to execute that in the root of technology adapters module. It will automatically declare the new module in parent \textit{pom.xml}.\\
		During the execution, further information will be asked, such as module name, version, file extension of technology files,â€¦ There is a default value for most of it, but it is not always relevant to keep the default value.
	
		\subsubsection{With IDE}
		IDE like Eclipse has the tools to reference an archetype catalogue, and generation is possible directly with these tools. No default values are set in Eclipse, each field will have to be filled by hand. The archetype is currently in a SNAPSHOT version, corresponding check-box has to be checked to see it. If it is still not in the list, The catalogue has to be referenced with the following url : https://maven.openflexo.org/artifactory/openflexo-snapshot/archetype-catalog.xml %TODO add some screenshot with Eclipse.

	\subsection{Content generated}
		\subsubsection{Modules (or projects)}
		Three modules have been generated, one containing the two others. and once imported in a IDE, three projects can be seen. On the file system it corresponds to directory named by the technology with a \textit{pom.xml} and two other directories containing each a \textit{pom.xml}. Directories' names are the technology name for the root one and the two others have the root directory name suffixed with connector and connector-ui respectively. The first one is just a Maven aggregation to simplify dependency declaration. In this section, Technology will be used as technology name.
		
		\subsubsection{Technologyconnector}
		Some packages have been generated. In a hierarchical vision, the root one contains four classes, and three other packages : model, rm and fml.
		\paragraph{Package model}~\\
		In this package, there are all concepts needed to describe the model. The usage of Pamela framework is recommended to describe your model. A simple example on how it could  be used it in this context is present in section~\ref{sec:implemToDo}. 
		\paragraph{Package rm}~\\
		The name rm stands for \textit{Resource Management}. In this package, there are two classes and one interface to handle that. The interface use the Pamela framework so its implementation class, referenced with annotation @ImplementationClass, can be abstract.\\
		The class TechnologyResourceRepository doesn't need too much implementations. Only the default base URI to identify models for this technology is defined in this class.\\
		The interface doesn't need any custom content either for file based resource. At the moment, other resource than a file based one is not really supported by the technology-adapter's API.\\
		The last class of the package is the interface's implementation. This class contains all methods that will be used to manage resources, like save, load, create resource and so on. A lot of methods here have default implementation and method that need custom implementation are listed in section~\ref{sec:implemToDo}.
		\paragraph{Package fml} ~\\
		The name fml stands for \textit{Free Modelling Language}. In this package, everything needed to configure model federation and all primitive of model manipulation have to be put here, which inherit from FlexoRole.
		
		\subsubsection{Technologyconnector-ui}
		There is 3 packages, each containing one class generated. The main class to fill is the ModuleView which is in the view package. This class has to inherit from a JComponent, and implements ModuleView. The default generated one inherit from JPanel, and is empty, but its goal is to provide a representation of a FlexoObject, which will need a specific representation.
		
	\subsection{Implementation needed}
	\label{sec:implemToDo}
		\paragraph{Setup dependencies}~\\
		The first thing to do is to add runtime dependencies at project to launch the executable with the newly generated technology adapter. The file \textit{pom.xml}, in flexosemantic project's root, contains all runtime dependencies. There are dependencies to freeplaneconnector and freeplaneconnector-ui declared. These have to be copy-pasted just below it and freeplane has to be replaced by the name of added technology.
		\paragraph{Techno-specific implementation}~\\
		First thing to after that is to reference the external libraries in the classpath, by creating a \textit{lib} directory in project root and put jars in it and referencing it in the build path. The next step is to define what the model is, i.e. which concept are relevant to manipulate and to represent. This will be used in the package model where an interface named TechnologyModel has been previously generated. Like said before, this interface uses Pamela framework, and the generated content shows what to write there. These is by default a property, its getter and setter associated. The cardinality LIST can be added to the getter, then the adder and remover to the interface has to be declared too (annotations are in the same package as @Getter and @Setter). No implementation has to be written if no specific operation has to be done when accessing to referenced property, Pamela handle all getters, setters and common implementations. This is also why the implementation class, which is in the same package, is abstract.\\
		The last implementation needed is in the package rm. The class there suffixed with \textit{ResourceImpl} need to have an implementation of \textit{loadResourceData}. Initialization of technology objects (from adapted library) associated with the resources and call the setter on the Openflexo object initialized in the method (this one is generated).
					
\end{document}
